<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
<meta name='apple-mobile-web-app-status-bar-style' content='black' />
<meta name='apple-mobile-web-app-capable' content='yes' />
<link rel='shortcut icon' href='/databrowser/img/favicon.ico' type='image/x-icon' />
<title>Tunisia Election Data | Votes qui ne comptent pas</title>
<link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
<link href='/databrowser/site.css' rel='stylesheet' />
<link href='/databrowser/maps.css' rel='stylesheet' />
<script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
<script src='https://raw.github.com/mapbox/mapbox.js/master/extensions/share.js'></script>
<script src='/databrowser/site.js'></script>
</head>
<body class=''>

  <div id='masthead' class='map'>
    <div class='limiter clearfix'>
      <a href='/databrowser/' class='title'><span class='icon logo'></span>Tunisia Election Data</a>
    </div>
  </div>

  <div class='header'>
    <div class='limiter clearfix'>
      <div class='nav'>
        <a href='/databrowser/fr/projects' class='button'>Projects</a>
        <a href='#' id='toggle' class='icon toggle'>Toggle Header</a>
      </div>
    </div>
    <div id='controls'></div>
  </div>

  <div class='map' id='map'></div>
   <a href='#' id='separator'></a>
   
  <div id='shelf' class='shelf' >
   <div id='description' class='shelf-inner'>
   
	
	<p>Cette carte permet de visualiser la proportion de bulletins de vote qui ont été invalidés au cours du dépouillement. Cela peut être  dû à une erreur de l'électeur à marquer le bulletin de vote, à la difficulté de déterminer l'intention de l'électeur, ou dû au fait que l'électeur abîme intentionnellement les bulletins de vote. Cela montre l’importance de l’impact positif d’une éducation plus robuste des électeurs. Au niveau national, près de 150.000 bulletins ont été invalidés lors du dépouillement dans les élections de l'Assemblée Nationale Constituante de 2011.</p>
	
   </div>
  <div id='sources' class='shelf-inner'>
    

	
	<div class='source-entry'>
	<h4 class='data-title'>Nombre de bulletins annulés</h4>
	<p><p>Cet ensemble de données a annulé les bulletins de vote lors des élections de 2011 en Tunisie. Cet ensemble de données a été obtenu à partir du rapport (PDF) de l&#8217;Assemblée Nationale Constituante sur les élections publié par l’ISIE en Février 2012 et fourni sous forme de fichiers .Json par OpenGovTN.</p></p>
	   
	   
	    
	   <a class='action data link' href='https://github.com/fwelections/tunisia-election-data/tree/master/fulldatasets/results'><span class='link'></span>www</a>
	   
	</div>
	
	 
   </div>
  <div id='methodology' class='shelf-inner'>
	

	<p>The map of <a href='http://fwelections.github.com/databrowser/en/canceled-during-counting/'>where cancelled votes came from</a> relies polling center data available as <a href='https://github.com/fwelections/tunisia-election-data/tree/master/fulldatasets/results'>individual <code>.json</code> files</a> that were provided as a two CSV tables - one containing latitude + longitude coordinates and the other containing detailed election data.</p>

<p>NOTE: Seule une partie des 4836 centres de vote est actuellement visualisée sur la carte. Bien que les données électorales aient été recueillies pour pratiquement tous les centres de vote, les données de géolocalisation (latitude et longitude) n&#8217;avaient été recueillies que seulement sur une partie des bureaux de vote.</p>

<p>Make sure you have read the <a href='http://github.com/fwelections/databrowser/blob/gh-pages/setup.md#data-management-and-maps'>documentation regarding installing and setting up a PostGIS-enabled database</a> before proceeding any further.</p>

<h3 id='1_import_data_to_postgis'>1. Import data to PostGIS</h3>

<p>To set up the election data table run the following SQL:</p>
<pre>
create table results (
	circonscription_name text,
	circonscription_isieid int,
	delegation_name text,
	delegation_isieid int,
	centre_name text,
	centre_isieid int,
	bureau_name text,
	bureau_isieid numeric,
	registred_voters numeric,
	total_voters numeric,
	extracted_ballots numeric,
	delivered_ballots numeric,
	white_ballots numeric,
	not_used_ballots numeric,
	cancelled_ballots numeric,
	damaged_ballots numeric,
	valid_ballots numeric,
	list_name text,
	list_rank numeric,
	votes numeric,
	percentage numeric
);
</pre>
<p>If you&#8217;ve parsed the <code>.json</code> files into a CSV you can import that CSV data by running the command</p>
<pre>
cat eligible_voters 2011data/election-results.csv | psql -d tunisia -c "COPY results FROM STDIN WITH DELIMITER ',' CSV HEADER"
</pre>
<p>We set up a separate table for the geometry with the following schema:</p>
<pre>
create table pc (
	district_name_ar text,
	delegation_name_ar text,
	polling_center_name_ar text,
	latitude numeric,
	longitude numeric,
	contact text
	);
</pre><pre>
cat shapes/polling_centers_tunisia.csv | psql -d tunisia -c "COPY pc FROM STDIN WITH DELIMITER ',' CSV HEADER"
</pre>
<h3 id='2_aggregate_polling_center_data__join_to_geometry'>2. Aggregate Polling Center data + join to geometry</h3>

<p>The data is structured so that each record (row) represents a party on the ballot at each polling center. To effectively show how many ballots were cancelled at each polling center, we need to</p>

<ul>
<li>aggregate this data into statistics for each polling center. In addition to aggregating this data</li>

<li>join to lat/lon data</li>

<li>create a unique polling center id</li>
</ul>

<p>This can be accomplished with the following query.</p>
<pre>
create table pc_results as (
	select 
		a.district_name_ar,
 		a.delegation_name_ar,
 		a.polling_center_name_ar,
 		a.latitude,
 		a.longitude,
 		a.contact,
		b.circonscription_name,
		b.circonscription_isieid,
		b.delegation_name,
		b.delegation_isieid,
		b.centre_name,
		b.centre_isieid,
		b.id,
		b.registred_voters,
		b.total_voters,
		b.extracted_ballots,
		b.delivered_ballots,
		b.white_ballots,
		b.not_used_ballots,
		b.cancelled_ballots,
		b.damaged_ballots,
		b.valid_ballots,
		b.votes
	from pc a left join (
		select
			circonscription_name,
			circonscription_isieid,
			delegation_name,
			delegation_isieid,
			cast(cast(circonscription_isieid as text)||cast(delegation_isieid as text)||cast(centre_isieid as text) as int) as id,
			centre_name,
			centre_isieid,
			sum(registred_voters) as registred_voters,
			sum(total_voters) as total_voters,
			sum(extracted_ballots) as extracted_ballots,
			sum(delivered_ballots) as delivered_ballots,
			sum(white_ballots) as white_ballots,
			sum(not_used_ballots) as not_used_ballots,
			sum(cancelled_ballots) as cancelled_ballots,
			sum(damaged_ballots) as damaged_ballots,
			sum(valid_ballots) as valid_ballots,
			sum(votes) as votes
		from results 
		group by circonscription_name,circonscription_isieid,delegation_name,delegation_isieid,centre_name,centre_isieid
	) b
	on polling_center_name_ar = centre_name
);
</pre>
<p>You can now use the <code>pc_results</code> table in the <a href='http://github.com/fwelections/databrowser/tree/gh-pages/map-src/canceled'>canceled-votes tilemill project</a> to style your data.</p>
<style type='text/css'>
.pol-party {
	display: none;
}
<script type='text/javascript'>
$('.legend-title').html('Ballots invalidated at counting');

</script>
</style>
	
   </div>
</div>
  <div class='downcontrols'>
      <a id="desc" href="#" class='active' rel='description'><span>Description</span></a>
      <a id="about" href="#" rel='sources'><span>About the data</span></a>
      <a href="#" id="meth" rel='methodology'><span>Methodology</span></a>
 </div>
  <div class='map-overlay frcanceled-during-counting'>
    <div id='infographic' style='display:none'>
  </div>
  

</div>
  <div class='attribution'>
    A project by
    <a href='http://www.democracyinternational.com'>Democracy International</a>, <a href='http://newrightsgroup.net'>New Rights Group</a> and <a href='http://developmentseed.org'>DevelopmentSeed</a> 
  </div>
</div>

<style>
  /* Using fr find out the .tooltip lang-*
   * We should display:block to. */
  .tooltip .lang-fr,
  .tootip .lang-fr {
    display:block!important;
  }
</style>



<script>
$(function () {
  mapbox.load('tunisia.map-qyh27u2n,tunisia.cancelled', function(o) {
      var map = mapbox.map('map');
      map.addLayer(o.layer)
      map.setZoomRange(7, 12);
      
      map.zoom(8).center({lat:36.18, lon:10.569})
      map.setPanLimits([{ lat: 2.0532, lon:4.2235 }, { lat: 42.5925, lon:17.8268 }]);


      

    map.interaction.auto()
    map.interaction.on('on');
    map.interaction.off('off');
    map.interaction.on({
        on: function(o) {
            $('.value').digits();
        },
        off: function(){
          $('.wax-tooltip').hide();
        }
    });

      var c = document.getElementById('controls');
      map.ui.zoomer.add().appendTo(c);
      mapbox.share().add().appendTo(c);
      map.ui.hash.add();
  });

  //Modal Popup box for data
  $('a#learn-more').bind('click', openModal);

  function openModal() {
    $('#modal').fadeIn('fast');
    window.location.hash = 'learn-more'
    return false;
  }

  if (location.hash === '#learn-more') {
    openModal();
  }

  $('.close').click(function (e) {
    $('#overlay, #modal').fadeOut();
    window.location.hash = '';
    return false;
  });
});


  $('#toggle').click(function(){
    $('.header').toggleClass('active-header', 20000 );
    $('#my-slider').toggle()
  })

  
</script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-88478-37']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>

