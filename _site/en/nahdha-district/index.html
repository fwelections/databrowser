<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />
<meta name='apple-mobile-web-app-status-bar-style' content='black' />
<meta name='apple-mobile-web-app-capable' content='yes' />
<link rel='shortcut icon' href='/databrowser/img/favicon.ico' type='image/x-icon' />
<title>Tunisia Election Data | Political party and coalition support</title>
<link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.css' rel='stylesheet' />
<link href='/databrowser/site.css' rel='stylesheet' />
<link href='/databrowser/maps.css' rel='stylesheet' />
<script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.7/mapbox.js'></script>
<script src='https://raw.github.com/mapbox/mapbox.js/master/extensions/share.js'></script>
<script src='/databrowser/site.js'></script>
</head>
<body class=''>

  <div id='masthead' class='map'>
    <div class='limiter clearfix'>
      <a href='/databrowser/' class='title'><span class='icon logo'></span>Tunisia Election Data</a>
    </div>
  </div>

  <div class='header'>
    <div class='limiter clearfix'>
      <div class='nav'>
        <a href='/databrowser/en/projects' class='button'>Projects</a>
        <a href='#' id='toggle' class='icon toggle'>Toggle Header</a>
      </div>
    </div>
    <div id='controls'></div>
  </div>

  <div class='map' id='map'></div>
   <a href='#' id='separator'></a>
   
  <div id='shelf' class='shelf' >
   <div id='description' class='shelf-inner'>
   
	
	<p>This visualization highlights the density of electoral district-level support for Ennahdha in the 2011 National Constituent Assembly elections.  Ennahdha won 89 seats and received the highest percentage of votes in 26 of 27 electoral districts in Tunisia; in Sidi Bouzid, Ennahdha finished with the second highest percentage of votes behind Popular Petition (Aridha).  Ennahdha also received the highest percentage of votes in all six out-of-country (OCV) voting districts.</p>
	
   </div>
  <div id='sources' class='shelf-inner'>
    

	
	<div class='source-entry'>
	<h4 class='data-title'>Tabular data for Ennahdha election results from the 2011 National Constituent Assembly elections.</h4>
	<p><p>This CSV contains TO COMPLETE . It was originally obtained from the <a href='http://www.isie.tn/Fr/image.php?id=771'>National Constituent Assembly Report on the Elections (PDF)</a>, published by the <a href='http://www.isie.tn'>Independent High Commission for Elections</a> in February, 2012, and converted to CSV by <a href='https://github.com/fwelections/tunisia-election-data'>OpenGovTN</a>.</p></p>
	   
	   
	    
	   <a class='action data link' href='https://github.com/fwelections/tunisia-election-data/blob/master/2011data/resultsPerParty/Nahdha.csv'><span class='link'></span>www</a>
	   
	</div>
	
	 
   </div>
  <div id='methodology' class='shelf-inner'>
	

	<p> CHANGE <br />Tunisia is made up of 24 governorates, which are subdivided into 264 delegations. This map visualizes the disparity between actively registered voters and eligible voters by delegation. Actively registered voters meet the age and citizenship requirements for voting and have registered to vote. Eligible voters meet the requirements to vote, but have not actively registered to vote. </p>
<p>Make sure you have read the <a href='http://github.com/fwelections/databrowser/blob/gh-pages/setup.md#data-management-and-maps'>documentation regarding installing and setting up a PostGIS-enabled database</a>.</p>

<h3 id='importing_data_to_postgis'>Importing data to PostGIS</h3>

<p>This map is comprised of two datasets - <a href='https://github.com/fwelections/tunisia-election-data/tree/master/shapes'>delegation shapefiles</a> and tabular <a href='https://github.com/fwelections/tunisia-election-data/blob/master/2011data/RegistrationDistributionPerDelegation/RegistDistibutionperDelegation.csv'>eligibility + registration data</a>. To import the shapefiles see the <a href='http://github.com/fwelections/databrowser/blob/gh-pages/setup.md#importing-geographic-data-to-postgis'>setup.md for instructions on importing geographic data</a>.</p>

<p>To import the tabular registration + eligibility data, first set up the table in the tunisia database. Run the following SQL to set up your table.</p>
<pre>
create table regis (
	district_id int,
	district text,
	delegation text, 
	actively_registred numeric,
	eligible_voters numeric,
	ratio numeric
	);
</pre>
<p>To populate the table, run the following from your command line (not the command shell)</p>
<pre>
	 cat path-to/2011data/RegistrationDistributionPerDelegation/RegistDistibutionperDelegation.csv | psql -d tunisia -c "COPY regis FROM STDIN WITH DELIMITER ',' CSV HEADER"
</pre>
<h3 id='joining_spatial_data_to_tabular_data'>Joining spatial data to tabular data</h3>

<p>Now that both datasets are in your postgres database, you need join the spatial data (the delegation shapefile) to the tabular data (the RegistDistibutionperDelegation.csv). To do this, run the following SQL.</p>
<pre>
create table eligibility as (
	select
		a.*,
		coalesce(cast(b.actively_registred as text), 'n/a') as actively_registred,
		coalesce(cast(b.eligible_voters as text), 'n/a') as eligible_voters,
		ratio,
		coalesce(cast(round(b.ratio) as text)||'%', 'n/a') as ratio_c
	from delegations a left join regis b
	on replace(replace(lower(cast(circo_id as text)||name_deleg), ' ', ''), '-', '') = replace(replace(replace(lower(cast(district_id as text)||delegation), ' ', ''), '-', ''), '\r', '')
	order by ratio desc
);
</pre>
<p>In addition to performing a <code>left join</code> on the geometry to preserve geometry where records from the tabular data do not match, this query reformats the <code>actively_registered</code>, <code>eligible_voters</code>, and <code>ratio</code> columns for cartographic purposes.</p>

<ul>
<li><strong>Round</strong> each value to the nearest integer</li>

<li><strong>Cast</strong> values in each column as text in order to concatenate a <code>%</code> sign.</li>

<li><strong>Coalesce</strong> each value and then the string &#8216;n/a&#8217; so that NULL values are still displayed accurately and aesthetically.</li>
</ul>

<p>Note that only about 215 of the 270 or so records (rows) match. To get the rest of the records to match, run manual updates changing the names in only one table.</p>
<pre>
update regis set delegation = 'Médina' where delegation = 'Medina';
</pre>
<p>You&#8217;re now ready to style your map in TileMill. Create a new project. In TileMill create a PostGIS layer following the <a href='http://mapbox.com/tilemill/docs/guides/postgis-work/'>online documentation</a>, specifying the <code>eligibility</code> table.</p>

<p>Paste in the appropriate html for the and <a href='http://github.com/fwelections/databrowser/blob/gh-pages/map-src/tooltip-src.html'>tooltip</a> (labeled &#8216;eligibility&#8217;) See the <a href='http://github.com/fwelections/databrowser/tree/gh-pages/map-src/eligibility'>Eligibility TileMill project</a> for CartoCss styles.</p>
	
   </div>
</div>
  <div class='downcontrols'>
      <a id="desc" href="#" class='active' rel='description'><span>Description</span></a>
      <a id="about" href="#" rel='sources'><span>About the data</span></a>
      <a href="#" id="meth" rel='methodology'><span>Methodology</span></a>
 </div>
  <div class='map-overlay ennahdha-district'>
    <div id='infographic' style='display:none'>
  </div>
  

</div>
  <div class='attribution'>
    A project by
    <a href='http://www.democracyinternational.com'>Democracy International</a>, <a href='http://newrightsgroup.net'>New Rights Group</a> and <a href='http://developmentseed.org'>DevelopmentSeed</a> 
  </div>
</div>

<style>
  /* Using en find out the .tooltip lang-*
   * We should display:block to. */
  .tooltip .lang-en,
  .tootip .lang-en {
    display:block!important;
  }
</style>



<script>
$(function () {
  mapbox.load('tunisia.map-1ztr9c9r', function(o) {
      var map = mapbox.map('map');
      map.addLayer(o.layer)
      map.setZoomRange(7, 12);
      
      map.zoom(8).center({lat:36.18, lon:10.569})
      map.setPanLimits([{ lat: 2.0532, lon:4.2235 }, { lat: 42.5925, lon:17.8268 }]);


      

    map.interaction.auto()
    map.interaction.on('on');
    map.interaction.off('off');
    map.interaction.on({
        on: function(o) {
            $('.value').digits();
        },
        off: function(){
          $('.wax-tooltip').hide();
        }
    });

      var c = document.getElementById('controls');
      map.ui.zoomer.add().appendTo(c);
      mapbox.share().add().appendTo(c);
      map.ui.hash.add();
  });

  //Modal Popup box for data
  $('a#learn-more').bind('click', openModal);

  function openModal() {
    $('#modal').fadeIn('fast');
    window.location.hash = 'learn-more'
    return false;
  }

  if (location.hash === '#learn-more') {
    openModal();
  }

  $('.close').click(function (e) {
    $('#overlay, #modal').fadeOut();
    window.location.hash = '';
    return false;
  });
});


  $('#toggle').click(function(){
    $('.header').toggleClass('active-header', 20000 );
    $('#my-slider').toggle()
  })

  
</script>
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-88478-37']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>

